# =============================================================================
# Canary MCP Server - Environment Configuration
# =============================================================================
# This file contains all configuration variables for the Canary MCP Server.
# Copy this file to .env and update with your actual values.
#
# IMPORTANT: Never commit .env to version control - it contains sensitive data!
#
# This configuration works identically for both installation methods:
#   - Non-Admin Windows Installation (user-space Python)
#   - Docker Installation (containerized deployment)
# =============================================================================

# -----------------------------------------------------------------------------
# REQUIRED: Canary API Configuration
# -----------------------------------------------------------------------------
# These variables are REQUIRED for the MCP server to function.

# CANARY_SAF_BASE_URL: Base URL for Canary SAF (Store and Forward) API
# Example: https://your-canary-instance.com:55236/api/v1
CANARY_SAF_BASE_URL=https://scunscanary.secil.pt:55236/api/v1

# CANARY_VIEWS_BASE_URL: Base URL for Canary Views API
# Example: https://your-canary-instance.com:55236
CANARY_VIEWS_BASE_URL=https://scunscanary.secil.pt:55236

# CANARY_API_TOKEN: Authentication token for Canary API
# Obtain this from your Canary administrator
# IMPORTANT: Keep this secret! Do not share or commit to version control.
CANARY_API_TOKEN=your_api_token_here

# -----------------------------------------------------------------------------
# Canary Client Configuration
# -----------------------------------------------------------------------------

# CANARY_CLIENT_ID: Unique identifier for this MCP server client
# Used for tracking and logging purposes
CANARY_CLIENT_ID=canary-mcp-server

# CANARY_HISTORIANS: Comma-separated list of historian names to query
# Leave empty to query all available historians
CANARY_HISTORIANS=

# CANARY_TAG_SEARCH_ROOT: Root namespace used when browsing tags.
# Example: Secil.Portugal (ensures search_tags scopes to the desired site)
CANARY_TAG_SEARCH_ROOT=Secil.Portugal

# CANARY_TAG_SEARCH_FALLBACKS: Optional comma-separated fallback namespaces
# tried when the root path returns no matches.
CANARY_TAG_SEARCH_FALLBACKS=

# CANARY_ASSET_VIEW: Canary view used by get_asset_types/get_asset_instances
# Example: Views/MyAssetModels
CANARY_ASSET_VIEW=

# CANARY_DEFAULT_VIEW: Default view to use for timeseries data queries.
# If not set, the Canary server's default view will be used.
# Example: localhost
CANARY_DEFAULT_VIEW=localhost


# CANARY_LAST_VALUE_LOOKBACK_HOURS: Hours to look back when fetching last known samples
CANARY_LAST_VALUE_LOOKBACK_HOURS=24

# CANARY_LAST_VALUE_PAGE_SIZE: Maximum number of samples requested when resolving last values
CANARY_LAST_VALUE_PAGE_SIZE=500

# CANARY_SERVER_URL: Direct URL to Canary server (alternative to SAF/Views URLs)
# Use this for direct server access without API gateway
CANARY_SERVER_URL=https://scunscanary.secil.pt/
# Alternative: Use IP address for local network access
# CANARY_SERVER_URL=172.21.2.103

# -----------------------------------------------------------------------------
# Performance & Resource Settings
# -----------------------------------------------------------------------------

# CANARY_POOL_SIZE: Maximum number of concurrent HTTP connections in pool
# Default: 10. Increase for higher concurrency, decrease to reduce memory
# Story 2.1: Connection pooling for performance optimization
CANARY_POOL_SIZE=10

# CANARY_TIMEOUT: Connection timeout for individual requests in seconds
# Default: 30. Maximum time to wait for a single request to complete
# Story 2.1: Request timeout configuration
CANARY_TIMEOUT=30

# CANARY_RATE_LIMIT_RPS: Maximum requests per second to Canary API
# Prevents overwhelming the server. Default: 500
# Reduce if experiencing rate limiting errors
CANARY_RATE_LIMIT_RPS=500

# CANARY_QUEUE_CAPACITY: Maximum number of queued requests
# Default: 1000. Increase for high-throughput scenarios
CANARY_QUEUE_CAPACITY=1000

# CANARY_MAX_BATCH_TAGS: Maximum number of tags per batch request
# Default: 100. Larger batches = fewer requests but higher memory usage
CANARY_MAX_BATCH_TAGS=100

# CANARY_MAX_PAYLOAD_BYTES: Maximum request payload size in bytes
# Default: 1048576 (1 MB). Prevent oversized requests
CANARY_MAX_PAYLOAD_BYTES=1048576

# -----------------------------------------------------------------------------
# Retry & Timeout Configuration
# -----------------------------------------------------------------------------

# CANARY_REQUEST_TIMEOUT_SECONDS: Timeout for individual HTTP requests
# Default: 10 seconds. Increase for slow networks
# Used by: All MCP tools making HTTP requests
CANARY_REQUEST_TIMEOUT_SECONDS=10

# CANARY_RETRY_ATTEMPTS: Number of retry attempts for failed requests
# Default: 6. Exponential backoff applied between retries
# Set to 0 to disable retries
CANARY_RETRY_ATTEMPTS=6

# CANARY_RETRY_BASE_DELAY_SECONDS: Initial delay before first retry
# Default: 1 second. Exponential backoff multiplies this value
CANARY_RETRY_BASE_DELAY_SECONDS=1

# CANARY_RETRY_MAX_DELAY_SECONDS: Maximum delay between retry attempts
# Default: 60 seconds. Prevents excessively long waits
CANARY_RETRY_MAX_DELAY_SECONDS=60

# -----------------------------------------------------------------------------
# Circuit Breaker Configuration
# -----------------------------------------------------------------------------
# Circuit breaker prevents cascading failures by temporarily stopping requests
# to failing services, allowing them time to recover.

# CANARY_CIRCUIT_CONSECUTIVE_FAILURES: Number of consecutive failures to trip circuit
# Default: 5. Circuit opens after this many failures
CANARY_CIRCUIT_CONSECUTIVE_FAILURES=5

# CANARY_CIRCUIT_RESET_SECONDS: Time to wait before attempting to close circuit
# Default: 60 seconds. Circuit enters half-open state after this period
CANARY_CIRCUIT_RESET_SECONDS=60

# -----------------------------------------------------------------------------
# Session & Keepalive Configuration
# -----------------------------------------------------------------------------

# CANARY_SESSION_TIMEOUT_MS: Session timeout in milliseconds
# Default: 120000 (2 minutes). Sessions expire after this period of inactivity
# Increase for long-running operations
CANARY_SESSION_TIMEOUT_MS=120000

# CANARY_KEEPALIVE_IDLE_SECONDS: Idle time before sending keepalive
# Default: 30 seconds. Prevents session timeout during idle periods
CANARY_KEEPALIVE_IDLE_SECONDS=30

# CANARY_KEEPALIVE_JITTER_SECONDS: Random jitter added to keepalive interval
# Default: 10 seconds. Prevents synchronized keepalive storms
CANARY_KEEPALIVE_JITTER_SECONDS=10

# -----------------------------------------------------------------------------
# Canary Dataset Configuration
# -----------------------------------------------------------------------------

# CANARY_DATASET_PREFIX: Prefix for dataset names when querying/writing
# Default: Secil. Used to namespace datasets
CANARY_DATASET_PREFIX=Secil

# CANARY_DATASET_OVERRIDE: Override dataset name for testing
# Leave commented for production use
# Uncomment for test/dev environments
# CANARY_DATASET_OVERRIDE=Test

# CANARY_DATASET_PREFIX: Prefix for dataset names when querying/writing
# Default: Secil. Used to namespace datasets
CANARY_DATASET_PREFIX=Secil
CANARY_DEFAULT_VIEW=Secil
# -----------------------------------------------------------------------------
# Canary Writer Configuration
# -----------------------------------------------------------------------------

# CANARY_WRITER_ENABLED: Enable/disable write operations to Canary
# Default: true. Set to false for read-only mode
# Useful for testing or when write permissions not available
CANARY_WRITER_ENABLED=true

# CANARY_TESTER_ROLES: Comma-separated roles allowed to invoke write_test_dataset
# Default: tester. Expand when onboarding additional QA/test users.
CANARY_TESTER_ROLES=tester,qa

# CANARY_WRITE_ALLOWED_DATASETS: Comma-separated whitelist of datasets for writes
# Defaults to Test/Maceira and Test/Outao per Epic 4 policy.
CANARY_WRITE_ALLOWED_DATASETS=Test/Maceira,Test/Outao

# CANARY_SAF_AUTO_CREATE_DATASETS: Pass autoCreateDatasets=true when generating SAF sessions
# Keep true for test environments to auto-create Test/* datasets on demand.
CANARY_SAF_AUTO_CREATE_DATASETS=true

# CANARY_SAF_FILE_SIZE_MB: SAF fileSize setting used during session creation (default 8 MB)
CANARY_SAF_FILE_SIZE_MB=8

# -----------------------------------------------------------------------------
# Vector Search / RAG Configuration
# -----------------------------------------------------------------------------

# CANARY_ENABLE_VECTOR_SEARCH: Opt-in to semantic lookup (default: false)
CANARY_ENABLE_VECTOR_SEARCH=false

# CANARY_VECTOR_INDEX_PATH: Folder containing embeddings.npy, records.json, meta.json
CANARY_VECTOR_INDEX_PATH=data/vector-index

# CANARY_VECTOR_TOP_K: Number of semantic suggestions to consider per query
CANARY_VECTOR_TOP_K=5

# CANARY_VECTOR_DIM / CANARY_VECTOR_HASH_SEED control the hash embedding used by the builder + runtime
CANARY_VECTOR_DIM=512
CANARY_VECTOR_HASH_SEED=0

# -----------------------------------------------------------------------------
# MCP Server Configuration
# -----------------------------------------------------------------------------

# -----------------------------------------------------------------------------
# Weather & External Tooling Configuration
# -----------------------------------------------------------------------------
# CANARY_WEATHER_ENABLED: Toggle fetching weather data inside the `mcp_status` tool.
# Set to `false` or `0` to skip the HTTP call and rely on the fallback message.
CANARY_WEATHER_ENABLED=true
# CANARY_WEATHER_URL: Override the weather endpoint used by `mcp_status`.
# Defaults to a DNS-free wttr.in mirror (IP backed); keep the Host header if you
# swap to another provider.
CANARY_WEATHER_URL=http://5.9.243.187/Lisbon?format=j1

# -----------------------------------------------------------------------------
# FastMCP Transport Selection
# -----------------------------------------------------------------------------

# CANARY_MCP_TRANSPORT controls how the MCP server is exposed.
#   - stdio (default here) keeps the server local-only for development.
#   - Switch to http for remote access (see docs/REMOTE_HTTP_DEPLOYMENT.md).
#     Example: CANARY_MCP_TRANSPORT=http with CANARY_MCP_HOST=vmhost.secil.pt
#              and CANARY_MCP_PORT=8888 to expose over HTTPS reverse proxy.
CANARY_MCP_TRANSPORT=stdio

# CANARY_MCP_HOST and CANARY_MCP_PORT are only used when CANARY_MCP_TRANSPORT=http.
# Keep the defaults for local work; adjust when promoting to remote deployment.
CANARY_MCP_HOST=0.0.0.0
CANARY_MCP_PORT=6000

# MCP_SERVER_HOST and MCP_SERVER_PORT are used by local test harnesses.
# Keep MCP_SERVER_PORT aligned with CANARY_MCP_PORT unless exposing multiple endpoints.
MCP_SERVER_HOST=127.0.0.1
MCP_SERVER_PORT=6000

# -----------------------------------------------------------------------------
# Caching Configuration (Story 2.2)
# -----------------------------------------------------------------------------

# CANARY_CACHE_DIR: Directory for cache database
# Default: .cache (relative to project root)
CANARY_CACHE_DIR=.cache

# CANARY_CACHE_METADATA_TTL: Time-to-live for metadata cache in seconds
# Default: 3600 (1 hour). Tag metadata changes infrequently
CANARY_CACHE_METADATA_TTL=3600

# CANARY_CACHE_TIMESERIES_TTL: Time-to-live for timeseries cache in seconds
# Default: 300 (5 minutes). Recent data cached for quick repeated queries
CANARY_CACHE_TIMESERIES_TTL=300

# CANARY_CACHE_MAX_SIZE_MB: Maximum cache size in megabytes
# Default: 100. Cache uses LRU eviction when limit reached
# Increase for better performance with many queries, decrease to save disk space
CANARY_CACHE_MAX_SIZE_MB=100

# -----------------------------------------------------------------------------
# Logging Configuration
# -----------------------------------------------------------------------------

# LOG_LEVEL: Logging verbosity level
# Options: DEBUG, INFO, WARNING, ERROR, CRITICAL
# Default: INFO
# - DEBUG: Detailed diagnostic information (verbose)
# - INFO: General informational messages (recommended)
# - WARNING: Warning messages for potential issues
# - ERROR: Error messages for failures
# - CRITICAL: Critical failures only (minimal logging)
LOG_LEVEL=INFO
